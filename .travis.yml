language: java
jdk: openjdk11
os: linux
dist: xenial
cache:
  timeout: 180
  directories:
  - "$HOME/.m2/repository"
install:
- mvn install -U -DskipTests=true -Dmaven.javadoc.skip=true -B -V
script:
- if [[ "$TRAVIS_BRANCH" =~ master* ]]; then mvn test -B -P release; fi
- if ! [[ "$TRAVIS_BRANCH" =~ master* ]]; then mvn test -B; fi
before_deploy:
- if [[ "$TRAVIS_BRANCH" =~ master* ]]; then echo $GPG_SECRET_KEYS | base64 --decode
  | $GPG_EXECUTABLE --import; fi
- if [[ "$TRAVIS_BRANCH" =~ master* ]]; then echo $GPG_OWNERTRUST | base64 --decode
  | $GPG_EXECUTABLE --import-ownertrust; fi
deploy:
- provider: script
  script: cp .travis.settings.xml $HOME/.m2/settings.xml && mvn deploy -DskipTests=true
  cleanup: false
  skip_cleanup: true
  on:
    branch: develop
- provider: script
  script: cp .travis.settings.xml $HOME/.m2/settings.xml && mvn deploy -P release
    -DskipTests=true
  cleanup: false
  skip_cleanup: true
  on:
    branch: master
before_cache:
- rm -rf $HOME/.m2/repository/org/opencds/cqf/cql-engine
- rm -rf $HOME/.m2/repository/org/opencds/cqf/cql-engine-fhir
- rm -rf $HOME/.m2/repository/org/opencds/cqf/cql-parent
notifications:
  slack:
    rooms:
      secure: ls3HU68fKzvrgvXTWK1YSof2IV9Yc2G+xHi/L/SZZMseEZyBLy70ufK559IArnr/g0Zmp0XGIYCIpawTRNa9AuR09UcQBBRkoKKb8UqGwW+DXaBRAHUJKf7Fzt1JnsbxjHQam+AVC3MKmvN+9ardWIFHxa8FsCkG+11AHUrmRkeyt0Jx6KzJHZLOTqkSZCGplj3DfXVMArDM6zYaPwD82kEjQkLD75Ul+FQ9S83d+DN2q9aPxGa782v/qFHi068br7tnFvku7U7CoxcI1vuzsXmqZOHj7MGrcMCrVxEVmoN85ffIFdS8/N+o3kGxGv6TrDHvXUsPSkPY20n1Cg9V96IG3UL+qsa3bd1aBC8mjPUrmbCYb+Puk69raJbTO6DZ+0zOQFtKD6KVUzthsTHhkkPYO1OjDayD2ajBFipkdzg4nUvPFf7jdHoQh9dUmiqZ2TIU07digzq4B8fCOs/bJUxld+rsXreU20TFi9b/UHB6836wkzp3PCr0uI7oSwQWDhGeR+LRERsprVN+dHLxrA7eJupeHI33Ipx3GuufMPc0pYJ7J7NYBqioW4COdYZR++BDQzh7kYdBRzgH/oYw2gzGc0Gdig8b0TVhxn/mJtpoKdJfuMH4Q8UDC+qXxvv//Zz3jjDLpGVaY8bAGGFiY48AfXzNC7muy+Fp4SOdmFQ=
